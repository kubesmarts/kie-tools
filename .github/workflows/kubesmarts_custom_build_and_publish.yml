name: "Kubesmarts :: Custom version :: Build and Publish"

on:
  workflow_dispatch:
    inputs:
      dry_run:
        type: boolean
        default: true
      environment:
        description: Environment for the workflow (dev, staging, prod)
        required: true
        default: dev
      tag:
        description: Tag for the images and kie-tools branch, leave default for dev environment
        type: string
        required: true
        default: main
      version:
        description: Sandbox version, leave default for dev environment.
        type: string
        required: true
        default: 0.0.0

concurrency:
  group: kubesmarts-custom-build-publish-${{ github.event.inputs.environment }}
  cancel-in-progress: true

jobs:
  build_and_publish:
    uses: ./.github/workflows/kubesmarts_build_and_publish.yml
    with:
      dry_run: ${{ fromJSON(github.event.inputs.dry_run) }}
      environment: ${{ github.event.inputs.environment }}
      tag: ${{ github.event.inputs.tag }}
      version: ${{ github.event.inputs.version }}
    secrets:
      KIE1_TOKEN: ${{ secrets.KIE1_TOKEN }}
      KIE1_EMAIL: ${{ secrets.KIE1_EMAIL }}
      KIE1_USER_NAME: ${{ secrets.KIE1_USER_NAME }}
